var arrLang = new Array();
arrLang["en"] = new Array();
arrLang["vn"] = new Array();

// English content

// title
arrLang["en"]["brand"] = "COVID-19 Dashboard";

// nav tab 
arrLang["en"]["region"] = "Region";
arrLang["en"]["references"] = "References";
arrLang["en"]["about"] = "About Us";
arrLang["en"]["world"] = "World";
arrLang["en"]["vn"] = "Vietnam"
arrLang["en"]["about"] = "About Us";
arrLang["en"]["change_lang"] = "Change language";
arrLang["en"]["english"] = "English";
arrLang["en"]["vietnamese"] = "Vietnamese";

// index
arrLang["en"]["sum_world"] = "SUMMARY WORLDWIDE";
arrLang["en"]["sum_vn"] = "Summary in Vietnam";
arrLang["en"]["daily_new_cases"] = "Number of cases";
arrLang["en"]["daily_new_deaths"] = "Number of deaths";
arrLang["en"]["global_map"] = "COVID-19 GLOBAL MAP"
arrLang["en"]["cases_per_1m"] = "Case/1M population";
arrLang["en"]["select_filter"] = "Select Filter:";
arrLang["en"]["case_ratio"] = "number of cases by status";
arrLang["en"]["continent_ratio"] = "number of cases by continent";
arrLang["en"]["summary_by_country"] = "COVID-19 Summary by Country";
arrLang["en"]["date"] = "Date";
arrLang["en"]["daily_cases"] = "Daily cases";
arrLang["en"]["daily_deaths"] = "Daily deaths";

//vietnam
arrLang["en"]["daily_confirmed_death"] = "Daily Confirmed and Death Cases(Last 3 months)";
arrLang["en"]["city"] = "City/Province";
arrLang["en"]["summary_by_city"] = "COVID-19 Summary by City";
arrLang["en"]["vietnam_incidence_ratio"] = "Number of cases by gender";
arrLang["en"]["vietnam_nationality_ratio"] = "Number of cases by nationality";
arrLang["en"]["vietnam_agerange"] = "COVID-19 Cases by Age Ranges";
arrLang["en"]["vietnam_daily_gender"] = "COVID-19 Daily cases by gender";
arrLang["en"]["agerange"] = "Age range";

arrLang["en"]["total_cases"] = "Total cases";
arrLang["en"]["active"] = "Actives";
arrLang["en"]["recover"] = "Recovered";
arrLang["en"]["total_deaths"] = "Deaths";
arrLang["en"]["incidence_rate"] = "Incidence Rate"
arrLang["en"]["case_fatality_ratio"] = "Case-fatality Ratio"
arrLang["en"]["new_cases"] = "New cases";
arrLang["en"]["new_deaths"] = "New deaths";
arrLang["en"]["per_country"] = "SUMMARY OF CASES WORLDWIDE PER COUNTRIES";
arrLang["en"]["world_map"] = "COVID-19 World map";
arrLang["en"]["vn_map"] = "COVID-19 Vietnam map";
arrLang["en"]["us_map"] = "COVID-19 America map";

arrLang["en"]["country"] = "Countries and Territories";
arrLang["en"]["population"] = "Population 2019";

// button

arrLang["en"]["btn-cf"] = "Confirmed Cases";
arrLang["en"]["btn-pp"] = "Total cases/1M population";

// VN content

// title
arrLang["vn"]["brand"] = "Bảng Thông tin COVID-19";

// nav tab
arrLang["vn"]["region"] = "Khu vực";
arrLang["vn"]["references"] = "Tham khảo";
arrLang["vn"]["about"] = "Về chúng tôi";
arrLang["vn"]["world"] = "Thế giới";
arrLang["vn"]["vn"] = "Việt Nam"
arrLang["vn"]["us"] = "Hoa Kỳ";
arrLang["vn"]["eu"] = "Châu Âu";
arrLang["vn"]["change_lang"] = "đổi ngôn ngữ";
arrLang["vn"]["english"] = "Tiếng Anh";
arrLang["vn"]["vietnamese"] = "Tiếng Việt";

// index
arrLang["vn"]["sum_world"] = "TỔNG QUAN TOÀN CẦU";
arrLang["vn"]["sum_vn"] = "TÌNH HÌNH DỊCH BỆNH Ở VIỆT NAM";
arrLang["vn"]["daily_new_cases"] = "Số ca nhiễm";
arrLang["vn"]["daily_new_deaths"] = "Số ca tử vong";
arrLang["vn"]["global_map"] = "BẢN ĐỒ COVID-19 TOÀN CẦU";
arrLang["vn"]["cases_per_1m"] = "Số ca nhiễm/1 triệu người";
arrLang["vn"]["select_filter"] = "Chọn bộ lọc:";
arrLang["vn"]["case_ratio"] = "Số ca nhiễm theo trạng thái";
arrLang["vn"]["continent_ratio"] = "số ca nhiễm theo lục địa";
arrLang["vn"]["summary_by_country"] = "Tổng quan COVID-19 ở các quốc gia";
arrLang["vn"]["date"] = "Ngày";
arrLang["vn"]["daily_cases"] = "Ca nhiễm trong ngày";
arrLang["vn"]["daily_deaths"] = "Ca tử vong trong ngày";

//vietnam
arrLang["vn"]["daily_confirmed_death"] = "Số ca nhiễm mới và tử vong (3 tháng gần nhất)";
arrLang["vn"]["city"] = "Tỉnh/Thành phố";
arrLang["vn"]["summary_by_city"] = "Tổng quan COVID-19 ở các Tỉnh/Thành phố";
arrLang["vn"]["vietnam_incidence_ratio"] = "Số ca nhiễm theo giới tính";
arrLang["vn"]["vietnam_nationality_ratio"] = "số ca nhiễm theo quốc tịch";
arrLang["vn"]["vietnam_agerange"] = "Biểu đồ ca nhiễm theo độ tuổi"
arrLang["vn"]["vietnam_daily_gender"] = "Tỉ lệ nhiễm mới nam và nữ theo ngày";
arrLang["vn"]["agerange"] = "Độ tuổi";

arrLang["vn"]["total_cases"] = "Số ca nhiễm";
arrLang["vn"]["active"] = "Đang điều trị";
arrLang["vn"]["recover"] = "Khỏi";
arrLang["vn"]["total_deaths"] = "Tử vong";
arrLang["vn"]["incidence_rate"] = "TỈ LỆ MẮC MỚI"
arrLang["vn"]["case_fatality_ratio"] = "TỈ LỆ TỬ VONG"
arrLang["vn"]["new_cases"] = "Ca nhiễm mới";
arrLang["vn"]["new_deaths"] = "Ca tử vong mới";
arrLang["vn"]["per_country"] = "DIỄN BIẾN DỊCH Ở TỪNG NƯỚC";
arrLang["vn"]["world_map"] = "BẢN ĐỒ DIỄN BIẾN DỊCH TRÊN THẾ GIỚI";
arrLang["vn"]["vn_map"] = "BẢN ĐỒ COVID-19 ở Việt Nam";
arrLang["vn"]["us_map"] = "BẢN ĐỒ DIỄN BIẾN DỊCH Ở HOA KỲ";

arrLang["vn"]["country"] = "Quốc gia/Vùng lãnh thổ";
arrLang["vn"]["population"] = "Dân số(2019)";

// button

arrLang["vn"]["btn-cf"] = "Tổng số ca nhiễm";
arrLang["vn"]["btn-pp"] = "Số ca nhiễm/1 triệu người";


// Process translation
$(document).ready(function () {
    $(".translate").click(function () {
        var lang = $(this).attr("id");
        localStorage.setItem('language', lang);
        location.reload()
    });
    $(".lang").each(function (index, item) {
        $(this).text(arrLang[lang][$(this).attr("key")]);
    });
});

// load change language localstorage
var lang = localStorage.getItem('language');

function numberWithCommas(number) {
    x = number.innerHTML
    number.innerHTML = x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function get_last_update() {
    $.ajax({
        url: '/last_update',
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            last_update = new Date(data.last_update);
            var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', seccond: 'numeric' };
            if (localStorage.getItem('language') === "vn") {
                prefix = "Cập nhật lúc "
                region = "vi-VN"
            }
            else {
                prefix = "Last update "
                region = "en-US"
            }
            last_update = last_update.toLocaleDateString(region, options);
            document.getElementById('last_update').innerHTML = prefix + last_update;
        },
        failure: function (data) {
            alert(data.message);
        }
    })
}

function getSection() {
    if (sessionStorage['section']) {
        var menuLink = document.getElementById("navbarDropdownMenuLink")
        menuLink.innerHTML = arrLang[localStorage.getItem('language')][sessionStorage.getItem('section')]
    }
}

function setSection() {
    document.querySelectorAll('.nav-link.dropdown-item.lang').forEach(button => {
        button.onclick = () => {
            sessionStorage.setItem('section', button.getAttribute('key'));
        }
    });
}

function setLanguageButton() {
    if (localStorage.getItem('language') === "vn"){
        var s = document.createElement('SPAN');
        s.className = 'flag-icon flag-icon-vn'
        var nd = document.getElementById('navbarDropdown')
        nd.appendChild(s)
        nd.innerHTML+=  ' Tiếng Việt'
    }
    else{
        var s = document.createElement('SPAN');
        s.className = 'flag-icon flag-icon-us'
        var nd = document.getElementById('navbarDropdown')
        nd.appendChild(s)
        nd.innerHTML += ' English'
    }
}


document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.number_with_commas').forEach(numberWithCommas);
    get_last_update();
    getSection();
    setSection()
    setLanguageButton()
});



